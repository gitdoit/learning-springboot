# Spring AOP

参考资料

[springaop演进](https://javadoop.com/post/spring-aop-intro)



### AOP基本概念

##### 1 、Aspect  切面

​	切面由切入点和通知组成，可以包含同一种类型不同增强方法，例如事务处理和spring的异步方法处理可以理解为两个切面。

```java
@Aspect
public class MyAspect {
    /**
     * 切入点
     */
    @Pointcut("execution(* x.xx.xx.xx.xx.*(..))")
    public void pointCut(){}
    /**
     * 通知方法
     */
    @Before("pointCut()")
    public void beforeSing(JoinPoint joinPoint){
        // do work
    }
}
```

##### 2、JoinPoint 连接点

​	就是能够被织入通知的点，比如一个在一个方法的调用前、后等都可以看作是一个连接点，一个连接点由两个属性确定:方法和位置。spring只支持方法级别的连接点。

##### 3、PointCut 切入点

​	由于所有方法上都具有连接点，而我们实际使用中只希望在指定的地方用AOP做增强处理，切入点的作用就是使用一组规则来匹配指定的连接点。

##### 4、Advice 通知

​	通知就是在拦截到切入点之后要执行的代码，spring有前置通知、后置通知、环绕通知等等这几种。

##### 5、 Weaving 织入

​	**织入是一个过程，描述了如何将切面和业务对象连接起来**。织入可以在类的编译时期、类加载、运行时。在编译时织入的叫做静态代理，运行时织入的脚动态代理。

​	由于静态代理实在编译时产生AOP代理类，所以会比动态代理效率高些。AspectJ是静态代理的实现之一，可以配合Spring使用。

​	与静态代理不同，动态代理不会修改编译时产生的字节码，而是在运行时生成一个AOP代理对象，这个AOP代理对象包含了目标对象的所有方法，并在特定的切入点做了增强处理，然后调用原对象的方法。Spring有两种动态代理方式：JDK动态代理和CGLIB动态代理。

​	JDK代理通过反射来代理目标对此昂，并且要求被代理对象必须实现一个接口，然而当目标类没有实现接口的时候Spring则使用CGLIB来动态代理目标对象，CGLIB（Code Generation Library）是一个代码生成的类库，可以在运行时动态的生成某个类的子类，由于这种实现方式需要生成子类，所以用final修饰的类没法使用CGLIB。

##### 6、Advisor 增强器

​	通知就是通知它只包含在增强时需要执行的代码。切面时切面，它就是一个定义，一个模板，描述在什么地方做什么事情。增强器就是负责根据切面的定义具体实施工作的类，它在AspectJ中没有对应的概念，是Spring aop框架中的，一个增强器只包含一个通知。